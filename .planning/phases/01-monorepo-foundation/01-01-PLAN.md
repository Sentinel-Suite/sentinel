---
phase: 01-monorepo-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - nx.json
  - pnpm-workspace.yaml
  - package.json
  - tsconfig.base.json
  - tsconfig.node.json
  - tsconfig.react.json
  - biome.json
  - commitlint.config.cjs
  - .editorconfig
  - .gitignore
  - .npmrc
  - .nvmrc
  - .env.example
  - .vscode/settings.json
  - .vscode/extensions.json
  - .github/workflows/ci.yml
  - .github/dependabot.yml
  - .github/PULL_REQUEST_TEMPLATE.md
  - CONTRIBUTING.md
  - SECURITY.md
  - README.md
  - apps/api/package.json
  - apps/api/project.json
  - apps/api/tsconfig.json
  - apps/api/src/main.ts
  - apps/api/src/app.module.ts
  - apps/web/package.json
  - apps/web/project.json
  - apps/web/tsconfig.json
  - apps/web/next.config.ts
  - apps/web/postcss.config.mjs
  - apps/web/src/app/layout.tsx
  - apps/web/src/app/page.tsx
  - apps/web/src/app/globals.css
  - apps/admin/package.json
  - apps/admin/project.json
  - apps/admin/tsconfig.json
  - apps/admin/next.config.ts
  - apps/admin/postcss.config.mjs
  - apps/admin/src/app/layout.tsx
  - apps/admin/src/app/page.tsx
  - apps/admin/src/app/globals.css
  - apps/worker/package.json
  - apps/worker/src/index.ts
  - apps/docs/package.json
  - apps/docs/src/app/layout.tsx
  - apps/docs/src/app/page.tsx
  - packages/config/package.json
  - packages/config/tsconfig.json
  - packages/config/src/index.ts
  - packages/db/package.json
  - packages/db/tsconfig.json
  - packages/db/src/index.ts
  - packages/shared/package.json
  - packages/shared/tsconfig.json
  - packages/shared/src/index.ts
  - packages/api-client/package.json
  - packages/api-client/tsconfig.json
  - packages/api-client/src/index.ts
  - packages/ui/package.json
  - packages/ui/tsconfig.json
  - packages/ui/src/index.ts
  - packages/validators/package.json
  - packages/validators/tsconfig.json
  - packages/validators/src/index.ts
  - packages/auth/package.json
  - packages/auth/tsconfig.json
  - packages/auth/src/index.ts
autonomous: true
requirements:
  - INFR-01
  - INFR-02
  - INFR-07

must_haves:
  truths:
    - "pnpm install succeeds without errors on a fresh clone"
    - "Nx dependency graph shows all apps and packages as connected nodes"
    - "pnpm lint runs Biome checks across the entire monorepo without configuration errors"
    - "TypeScript compilation succeeds across all packages with strict mode"
  artifacts:
    - path: "nx.json"
      provides: "Nx workspace configuration with plugin inference"
      contains: "@nx/next/plugin"
    - path: "pnpm-workspace.yaml"
      provides: "pnpm workspace definition"
      contains: "apps/*"
    - path: "tsconfig.base.json"
      provides: "Root TypeScript config with @sentinel/* paths"
      contains: "@sentinel/*"
    - path: "biome.json"
      provides: "Root Biome linting and formatting config"
      contains: "formatter"
    - path: "apps/api/package.json"
      provides: "NestJS API app package definition"
      contains: "@nestjs/core"
    - path: "apps/web/package.json"
      provides: "Next.js web app package definition"
      contains: "next"
    - path: "packages/config/src/index.ts"
      provides: "Config package barrel export"
    - path: "packages/db/src/index.ts"
      provides: "DB package barrel export"
    - path: "packages/shared/src/index.ts"
      provides: "Shared package barrel export"
    - path: ".github/workflows/ci.yml"
      provides: "GitHub Actions CI pipeline"
      contains: "pnpm lint"
  key_links:
    - from: "apps/api/package.json"
      to: "@sentinel/config"
      via: "workspace:* dependency"
      pattern: '"@sentinel/config":\\s*"workspace:\\*"'
    - from: "apps/web/package.json"
      to: "@sentinel/ui"
      via: "workspace:* dependency"
      pattern: '"@sentinel/ui":\\s*"workspace:\\*"'
    - from: "biome.json"
      to: "all packages"
      via: "root config inherited by nested configs"
      pattern: '"extends":\\s*\\["//"]'
---

<objective>
Scaffold the complete Nx monorepo with all apps (api, web, admin, worker, docs), shared packages (config, db, shared, api-client, ui, validators, auth), TypeScript configurations, Biome linting/formatting, Git hooks, CI pipeline, and repository housekeeping files.

Purpose: Establish the foundational workspace structure that all subsequent plans build upon. Every file path, package name, and import convention is defined here.
Output: A valid Nx workspace with pnpm workspaces where `pnpm install` succeeds, `nx graph` shows the dependency tree, and `pnpm lint` runs Biome checks.
</objective>

<execution_context>
@/Users/darreljones/.claude/get-shit-done/workflows/execute-plan.md
@/Users/darreljones/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-monorepo-foundation/01-CONTEXT.md
@.planning/phases/01-monorepo-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Nx workspace with all apps and packages</name>
  <files>
    nx.json, pnpm-workspace.yaml, package.json, tsconfig.base.json, tsconfig.node.json, tsconfig.react.json,
    apps/api/package.json, apps/api/project.json, apps/api/tsconfig.json, apps/api/src/main.ts, apps/api/src/app.module.ts,
    apps/web/package.json, apps/web/project.json, apps/web/tsconfig.json, apps/web/next.config.ts, apps/web/postcss.config.mjs, apps/web/src/app/layout.tsx, apps/web/src/app/page.tsx, apps/web/src/app/globals.css,
    apps/admin/package.json, apps/admin/project.json, apps/admin/tsconfig.json, apps/admin/next.config.ts, apps/admin/postcss.config.mjs, apps/admin/src/app/layout.tsx, apps/admin/src/app/page.tsx, apps/admin/src/app/globals.css,
    apps/worker/package.json, apps/worker/src/index.ts,
    apps/docs/package.json, apps/docs/src/app/layout.tsx, apps/docs/src/app/page.tsx,
    packages/config/package.json, packages/config/tsconfig.json, packages/config/src/index.ts,
    packages/db/package.json, packages/db/tsconfig.json, packages/db/src/index.ts,
    packages/shared/package.json, packages/shared/tsconfig.json, packages/shared/src/index.ts,
    packages/api-client/package.json, packages/api-client/tsconfig.json, packages/api-client/src/index.ts,
    packages/ui/package.json, packages/ui/tsconfig.json, packages/ui/src/index.ts,
    packages/validators/package.json, packages/validators/tsconfig.json, packages/validators/src/index.ts,
    packages/auth/package.json, packages/auth/tsconfig.json, packages/auth/src/index.ts
  </files>
  <action>
    Create the Nx monorepo from scratch (greenfield -- no existing code).

    **Root workspace files:**
    1. `package.json` -- root package with `"name": "sentinel-suite"`, `"private": true`, `"packageManager": "pnpm@9.x"`. Scripts: `"dev": "nx run-many --target=dev --projects=api,web,admin"`, `"build": "nx run-many --target=build"`, `"lint": "biome check ."`, `"format": "biome format . --write"`, `"type-check": "nx run-many --target=type-check"`, `"test": "nx run-many --target=test"`. DevDependencies: nx@22, @nx/js, @nx/nest, @nx/next, @nx/workspace, typescript@5, @biomejs/biome@2.
    2. `pnpm-workspace.yaml` -- packages: `['apps/*', 'packages/*']`
    3. `nx.json` -- plugins: `@nx/next/plugin` (buildTargetName: build, devTargetName: dev, startTargetName: start), `@nx/nest/plugin` (buildTargetName: build, serveTargetName: serve). Set `defaultBase: "main"`, `namedInputs` for production files, `targetDefaults` for build/test caching.
    4. `tsconfig.base.json` -- strict: true, noUncheckedIndexedAccess: true, target: ES2022, module: Node16, moduleResolution: Node16, paths: `{"@sentinel/*": ["packages/*/src"]}`. Per research pattern.
    5. `tsconfig.node.json` -- extends tsconfig.base.json, adds Node-specific settings (types: ["node"]).
    6. `tsconfig.react.json` -- extends tsconfig.base.json, adds React settings (jsx: react-jsx, lib: ["dom", "dom.iterable", "esnext"]).

    **Functional apps (apps/api, apps/web, apps/admin):**

    `apps/api` (NestJS):
    - package.json: name "@sentinel/api", dependencies: @nestjs/core, @nestjs/common, @nestjs/platform-express, reflect-metadata, rxjs. workspace deps: "@sentinel/config": "workspace:*", "@sentinel/db": "workspace:*", "@sentinel/shared": "workspace:*". Scripts: "build", "serve", "type-check": "tsc --noEmit".
    - project.json: name "api", tags: ["scope:api", "type:app"].
    - tsconfig.json: extends ../../tsconfig.node.json, include src.
    - src/main.ts: Minimal NestJS bootstrap -- `NestFactory.create(AppModule)`, listen on port 3500. Placeholder for Pino (added in Plan 03).
    - src/app.module.ts: Minimal AppModule with empty imports array. Placeholder for LoggerModule, HealthModule (added in Plan 03).

    `apps/web` (Next.js):
    - package.json: name "@sentinel/web", dependencies: next@15, react, react-dom. devDependencies: tailwindcss@4, @tailwindcss/postcss, postcss. workspace deps: "@sentinel/ui": "workspace:*", "@sentinel/api-client": "workspace:*". Scripts: "dev": "next dev --port 3501", "build": "next build", "type-check": "tsc --noEmit".
    - project.json: name "web", tags: ["scope:web", "type:app"].
    - tsconfig.json: extends ../../tsconfig.react.json, include src, next-env.d.ts.
    - next.config.ts: transpilePackages: ["@sentinel/ui", "@sentinel/api-client"].
    - postcss.config.mjs: plugins: { "@tailwindcss/postcss": {} }.
    - src/app/globals.css: `@import "tailwindcss"` (Tailwind v4 syntax).
    - src/app/layout.tsx: Root layout with html/body, import globals.css, metadata title "Sentinel Suite".
    - src/app/page.tsx: Placeholder page with "Sentinel Suite - Web" heading. Placeholder for API status (added in Plan 03).

    `apps/admin` (Next.js):
    - Same structure as web but name "@sentinel/admin", port 3502, title "Sentinel Suite - Admin", heading "Sentinel Suite - Admin".
    - workspace deps: "@sentinel/ui": "workspace:*", "@sentinel/api-client": "workspace:*".

    **Stub apps (apps/worker, apps/docs):**

    `apps/worker` (BullMQ stub):
    - package.json: name "@sentinel/worker", no real dependencies. Single script: "build": "echo 'Worker stub -- not yet implemented'".
    - src/index.ts: `// BullMQ worker -- stub for Phase 1. Implementation in later phases.\nexport {};`

    `apps/docs` (Nextra stub):
    - package.json: name "@sentinel/docs", dependencies: nextra@4, next@15, react, react-dom. Scripts: "dev": "next dev --port 3504", "build": "next build".
    - src/app/layout.tsx: Minimal root layout.
    - src/app/page.tsx: "Sentinel Suite Documentation -- Coming Soon" heading.

    **Functional packages (config, db, shared):**

    `packages/config`:
    - package.json: name "@sentinel/config", main: "src/index.ts", types: "src/index.ts". Dependencies will be added in Plan 02 (t3-env, zod). For now, barrel export only.
    - tsconfig.json: extends ../../tsconfig.node.json.
    - src/index.ts: `// @sentinel/config -- Environment configuration\n// Functional implementation in Plan 02\nexport {};`

    `packages/db`:
    - package.json: name "@sentinel/db", main: "src/index.ts", types: "src/index.ts". Dependencies will be added in Plan 02 (drizzle-orm, pg). workspace deps: "@sentinel/config": "workspace:*".
    - tsconfig.json: extends ../../tsconfig.node.json.
    - src/index.ts: `// @sentinel/db -- Database client and schema\n// Functional implementation in Plan 02\nexport {};`

    `packages/shared`:
    - package.json: name "@sentinel/shared", main: "src/index.ts", types: "src/index.ts". No external dependencies.
    - tsconfig.json: extends ../../tsconfig.node.json.
    - src/index.ts: Re-export from result.ts and errors.ts.
    - src/result.ts: `Result<T, E>` type -- a discriminated union: `{ ok: true; value: T } | { ok: false; error: E }`. Include `ok()` and `err()` factory functions.
    - src/errors.ts: Base `AppError` class extending Error with `code: string` and `statusCode: number`. Subclasses: `NotFoundError`, `ValidationError`, `UnauthorizedError`, `ForbiddenError`. Each with appropriate default status codes.

    **Stub packages (api-client, ui, validators, auth):**
    Each gets: package.json (name @sentinel/{name}, main/types pointing to src/index.ts), tsconfig.json (extends ../../tsconfig.node.json for api-client/validators/auth, ../../tsconfig.react.json for ui), src/index.ts with a comment and `export {};`.

    `packages/ui`:
    - tsconfig.json extends ../../tsconfig.react.json (it's a React component library).

    **Cross-package dependencies (workspace:* protocol):**
    - apps/api depends on: @sentinel/config, @sentinel/db, @sentinel/shared
    - apps/web depends on: @sentinel/ui, @sentinel/api-client
    - apps/admin depends on: @sentinel/ui, @sentinel/api-client
    - packages/db depends on: @sentinel/config

    After creating all files, run `pnpm install` to install dependencies and validate the workspace.
    Then run `npx nx graph --file=output.json` to verify the dependency graph.

    IMPORTANT: Use @sentinel/ scope for ALL package names. Use workspace:* for ALL internal dependencies. Use fixed/unified versioning. All packages must have "version": "0.0.0".
  </action>
  <verify>
    <automated>cd /Users/darreljones/Development/sentinel-suite && pnpm install && npx nx graph --file=output.json && node -e "const g = require('./output.json'); const nodes = Object.keys(g.graph.nodes); console.log('Nodes:', nodes.length); console.assert(nodes.length >= 12, 'Expected at least 12 nodes (5 apps + 7 packages)');"</automated>
  </verify>
  <done>
    All 5 apps and 7 packages exist with valid package.json, tsconfig.json, and barrel exports. pnpm install succeeds. nx graph shows all nodes connected in the dependency tree. TypeScript paths resolve @sentinel/* imports.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Biome linting, Git hooks, CI pipeline, and repo housekeeping</name>
  <files>
    biome.json, commitlint.config.cjs, .editorconfig, .gitignore, .npmrc, .nvmrc, .env.example,
    .vscode/settings.json, .vscode/extensions.json,
    .github/workflows/ci.yml, .github/dependabot.yml, .github/PULL_REQUEST_TEMPLATE.md,
    CONTRIBUTING.md, SECURITY.md, README.md
  </files>
  <action>
    **Biome Configuration:**
    1. Root `biome.json`: schema v2, organizeImports enabled, formatter (indentStyle: space, indentWidth: 2, lineWidth: 100), linter (recommended rules), files.ignore: ["node_modules", "dist", ".next", ".nx", "coverage", "output.json"]. Per research Pattern 5.
    2. Add nested `biome.json` in each package/app directory with `"extends": ["//"]` (Biome v2 monorepo syntax). This is CRITICAL -- without it, nested directories won't inherit root rules.

    **Git Hooks (Husky v9 + lint-staged + commitlint):**
    1. Install: `pnpm add -D husky lint-staged @commitlint/cli @commitlint/config-conventional`
    2. Run `npx husky init` to create .husky/ directory.
    3. Create `.husky/pre-commit`: `npx lint-staged`
    4. Create `.husky/commit-msg`: `npx --no -- commitlint --edit ${1}`
    5. `commitlint.config.cjs`: `module.exports = { extends: ['@commitlint/config-conventional'] };`
    6. Add to root package.json: `"lint-staged": { "*.{ts,tsx,js,jsx,json,css,md}": ["biome check --write --no-errors-on-unmatched"] }`

    **GitHub Actions CI (.github/workflows/ci.yml):**
    Per research code example:
    - Trigger: push to main, PRs to main
    - Jobs: lint, type-check, test (all in one job for simplicity)
    - Steps: checkout (fetch-depth: 0), setup pnpm, setup node 22 with pnpm cache, pnpm install --frozen-lockfile, pnpm lint, pnpm type-check, pnpm test

    **Dependabot (.github/dependabot.yml):**
    - npm ecosystem, directory "/", weekly schedule, open-pull-requests-limit: 10, commit-message prefix "deps:"

    **PR Template (.github/PULL_REQUEST_TEMPLATE.md):**
    - Sections: Description, Type of Change (checkboxes), Testing, Checklist (conventional commits, lint passes, tests pass)

    **Repository Housekeeping:**

    `.gitignore`: Node, Next.js, Nx, Docker, IDE, env files, OS files, coverage, dist, .next, .nx, node_modules, .env (NOT .env.example), *.log, .DS_Store, output.json.

    `.npmrc`: `strict-peer-dependencies=true`, `audit=true`, `save-exact=true`.

    `.nvmrc`: `22`

    `.editorconfig`: root=true, UTF-8, LF line endings, indent_style=space, indent_size=2, trim_trailing_whitespace, insert_final_newline.

    `.env.example`: Document every environment variable with default values and inline comments. Include: NODE_ENV, LOG_LEVEL, API_PORT (3500), WEB_PORT (3501), ADMIN_PORT (3502), WORKER_PORT (3503), DOCS_PORT (3504), CONTROL_DATABASE_URL, REDIS_URL, POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB, POSTGRES_PORT (3510), REDIS_PORT (3511), plus all Docker service ports from research port table. Include SENTRY_DSN, FLAGSMITH_SERVER_SIDE_KEY, OTEL_EXPORTER_OTLP_ENDPOINT, LOKI_URL, METRICS_PORT (9464).

    `.vscode/settings.json`: Biome as default formatter, format on save, editor.defaultFormatter for ts/tsx/json, biome.lspBin path.
    `.vscode/extensions.json`: Recommend biomejs.biome, bradlc.vscode-tailwindcss, nrwl.angular-console (Nx Console), esbenp.prettier-vscode disabled.

    `CONTRIBUTING.md`: Prerequisites (Node 22, pnpm 9, Docker), setup steps (clone, pnpm install, make up, pnpm dev), branch naming (feat/, fix/, chore/), commit conventions, PR checklist, package creation guidelines (always use Nx generators).

    `SECURITY.md`: Vulnerability reporting process -- email security@sentinel.local, expected response time, responsible disclosure.

    `README.md`: Project name and one-line description, prerequisites, quick start (clone, install, docker, dev), architecture overview (monorepo structure with apps/ and packages/), package descriptions table, available scripts table, port assignments table.

    After all files are created, run `pnpm install` to ensure new devDependencies are installed, then run `pnpm lint` to verify Biome configuration works across the entire monorepo.
  </action>
  <verify>
    <automated>cd /Users/darreljones/Development/sentinel-suite && pnpm lint && test -f .husky/pre-commit && test -f .husky/commit-msg && test -f .github/workflows/ci.yml && echo "All checks passed"</automated>
  </verify>
  <done>
    Biome checks pass across all packages and apps. Husky hooks are installed (pre-commit runs lint-staged, commit-msg runs commitlint). GitHub Actions CI workflow exists. .gitignore, .env.example, .editorconfig, VSCode settings, README, CONTRIBUTING.md, and SECURITY.md all exist with correct content.
  </done>
</task>

</tasks>

<verification>
1. `pnpm install` completes without errors
2. `npx nx graph` shows 12+ nodes (5 apps + 7 packages) with correct dependency edges
3. `pnpm lint` runs Biome across entire monorepo without errors
4. All @sentinel/* packages resolve via TypeScript path mapping
5. Git hooks are installed and functional
6. GitHub Actions CI workflow file exists and is valid YAML
</verification>

<success_criteria>
- Fresh `pnpm install` succeeds with all workspace:* dependencies resolved
- Nx dependency graph shows all apps and packages with correct dependency edges
- `pnpm lint` and `pnpm format` execute Biome across the monorepo
- TypeScript strict mode with noUncheckedIndexedAccess enabled in base config
- All 5 apps have package.json + entry points (functional or stub)
- All 7 packages have package.json + barrel exports
- Repository has .gitignore, .env.example, README, CONTRIBUTING.md, CI pipeline
</success_criteria>

<output>
After completion, create `.planning/phases/01-monorepo-foundation/01-01-SUMMARY.md`
</output>
